(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{2956:(e,t,a)=>{"use strict";a.d(t,{u:()=>i});var r=a(3464),s=a(9018);let i=r.A.create({baseURL:"http://161.132.41.184:3000/api"});i.interceptors.request.use(e=>{let t=s.n.getState().token;return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&!window.location.pathname.endsWith("/login")&&(console.warn("API client: 401 Unauthorized, logging out."),s.n.getState().logout()),Promise.reject(e)))},5264:e=>{e.exports={tableWrapper:"PwaUserTable_tableWrapper__ym4q7",tableHeader:"PwaUserTable_tableHeader__MKEIP",filterRow:"PwaUserTable_filterRow__cfaXp",headerButton:"PwaUserTable_headerButton__5FKHS","mantine-Group-root":"PwaUserTable_mantine-Group-root__RgMUf",sortIcon:"PwaUserTable_sortIcon__1ekcj",sortIconDesc:"PwaUserTable_sortIconDesc__CWk0B",sortIconPlaceholder:"PwaUserTable_sortIconPlaceholder__VJwrz",dataRow:"PwaUserTable_dataRow__Lzaa0",paginationFooter:"PwaUserTable_paginationFooter__hKtiZ"}},5794:(e,t,a)=>{Promise.resolve().then(a.bind(a,8948))},6731:(e,t,a)=>{"use strict";a.d(t,{X:()=>s});var r=a(2956);let s={async getUsers(e){let t={};return t.page=e.pagination.pageIndex+1,t.limit=e.pagination.pageSize,e.sorting&&e.sorting.length>0&&(t.sortField=e.sorting[0].id,t.sortDirection=e.sorting[0].desc?"DESC":"ASC"),e.columnFilters&&e.columnFilters.length>0&&e.columnFilters.forEach(e=>{void 0!==e.value&&""!==e.value&&null!==e.value&&(t[e.id]=e.value)}),(await r.u.get("/users",{params:t})).data},async deactivateUser(e){await r.u.delete("/users/".concat(e))},async activateUser(e){await r.u.delete("/users/".concat(e))},async getUserById(e){if(console.log("PWAUSER_SERVICE: Attempting to fetch user with ID: ".concat(e)),!e)return console.error("PWAUSER_SERVICE: getUserById called with no ID."),Promise.reject(Error("User ID is required"));try{let t=await r.u.get("/users/".concat(e));return console.log("PWAUSER_SERVICE: Data received for ".concat(e,":"),t.data),t.data}catch(t){throw console.error("PWAUSER_SERVICE: Error fetching user ".concat(e,":"),t),t}},async updateUser(e,t){let{email:a,...s}=t;return(await r.u.patch("/users/".concat(e),s)).data}}},8948:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>W});var r=a(5155),s=a(2115),i=a(8104),n=a(112),l=a(3751),o=a(6707),c=a(4634),d=a(6701),u=a(8977),h=a(5782),g=a(1698),p=a(7017),x=a(6715),m=a(2960),j=a(5041),b=a(5695),w=a(6942),v=a(6731),y=a(1183),f=a(6029),A=a(1005),S=a(3191),k=a(6568),T=a(3608),_=a(8887),E=a(8593),U=a(597),C=a(8141),I=a(7120),z=a(1503),P=a(755),X=a(6343),R=a(4395),N=a(2439),F=a(5264),O=a.n(F);function D(e){let{users:t,isLoading:a,totalRowCount:s,pagination:l,sorting:o,columnFilters:c,onPaginationChange:u,onSortingChange:h,onColumnFiltersChange:g,onEditUser:p,handleToggleUserActivation:x}=e,m=[{key:"name",label:"Nombre Completo",sortable:!0,filterable:!0,filterType:"text"},{key:"email",label:"Correo",sortable:!0,filterable:!0,filterType:"text"},{key:"credits",label:"Cr\xe9ditos",sortable:!0,align:"center",width:"100px"},{key:"countryOfOrigin",label:"Pa\xeds Origen",sortable:!0,filterable:!0,filterType:"text",align:"center"},{key:"isActive",label:"Activo",sortable:!0,filterable:!0,filterType:"select",selectOptions:[{label:"S\xed",value:"true"},{label:"No",value:"false"}],align:"center",width:"100px"},{key:"createdAt",label:"Registro",sortable:!0,width:"120px"},{key:"actions",label:"Acciones",align:"center",width:"100px"}],j=e=>{let t;if(!v(e))return;let a=o.find(t=>t.id===e);h(a?a.desc?[]:[{id:e,desc:!0}]:[{id:e,desc:!1}])},b=(e,t)=>{g(a=>{let r=a.filter(t=>t.id!==e);return t&&r.push({id:e,value:t}),r})},w=e=>{let t=c.find(t=>t.id===e);return(null==t?void 0:t.value)||""},v=e=>{var t;return(null==(t=m.find(t=>t.key===e))?void 0:t.sortable)||!1},F=t.map(e=>(0,r.jsxs)(y.X.Tr,{className:O().dataRow,children:[(0,r.jsx)(y.X.Td,{children:e.name}),(0,r.jsx)(y.X.Td,{children:e.email}),(0,r.jsx)(y.X.Td,{style:{textAlign:"center"},children:e.credits}),(0,r.jsx)(y.X.Td,{style:{textAlign:"center"},children:e.countryOfOrigin||"N/A"}),(0,r.jsx)(y.X.Td,{style:{textAlign:"center"},children:(0,r.jsx)(f.E,{color:e.isActive?"teal":"pink",variant:"light",size:"sm",children:e.isActive?"S\xed":"No"})}),(0,r.jsx)(y.X.Td,{children:new Date(e.createdAt).toLocaleDateString("es-ES")}),(0,r.jsx)(y.X.Td,{style:{textAlign:"center"},children:(0,r.jsxs)(n.Y,{gap:"xs",justify:"center",wrap:"nowrap",children:[(0,r.jsx)(A.m,{label:"Editar Usuario",children:(0,r.jsx)(S.M,{variant:"subtle",color:"blue",onClick:()=>p(e),children:(0,r.jsx)(z.A,{size:18})})}),(0,r.jsx)(A.m,{label:e.isActive?"Desactivar Usuario":"Activar Usuario",children:(0,r.jsx)(S.M,{variant:"subtle",color:e.isActive?"red":"teal",onClick:()=>x(e),children:e.isActive?(0,r.jsx)(d.A,{size:18}):(0,r.jsx)(P.A,{size:18})})})]})})]},e.id)),D=Math.ceil(s/l.pageSize);return(0,r.jsxs)(i.a,{className:O().tableWrapper,children:[(0,r.jsx)(k.F,{children:(0,r.jsxs)(y.X,{striped:!0,highlightOnHover:!0,verticalSpacing:"sm",children:[(0,r.jsxs)(y.X.Thead,{className:O().tableHeader,children:[(0,r.jsx)(y.X.Tr,{children:m.map(e=>{var t;return(0,r.jsx)(y.X.Th,{style:{width:e.width,textAlign:e.align||"left"},children:(0,r.jsx)(T.N,{onClick:()=>j(e.key),className:O().headerButton,children:(0,r.jsxs)(n.Y,{gap:"xs",wrap:"nowrap",children:[(0,r.jsx)(_.E,{fw:500,children:e.label}),e.sortable&&o.find(t=>t.id===e.key)&&(0,r.jsx)(X.A,{size:14,className:"".concat(O().sortIcon," ").concat((null==(t=o.find(t=>t.id===e.key))?void 0:t.desc)?O().sortIconDesc:"")})]})})},e.key)})}),(0,r.jsx)(y.X.Tr,{className:O().filterRow,children:m.map((e,t)=>(0,r.jsxs)(y.X.Th,{style:{padding:"4px 8px"},children:[e.filterable&&"text"===e.filterType&&(0,r.jsx)(E.k,{placeholder:"Filtrar ".concat(e.label,"..."),value:w(e.key),onChange:t=>b(e.key,t.currentTarget.value),rightSection:w(e.key)?(0,r.jsx)(S.M,{size:"xs",variant:"transparent",onClick:()=>b(e.key,""),children:(0,r.jsx)(R.A,{size:14})}):(0,r.jsx)(N.A,{size:14}),size:"xs"}),e.filterable&&"select"===e.filterType&&(0,r.jsx)(U.l,{placeholder:"Filtrar ".concat(e.label,"..."),value:w(e.key),onChange:t=>b(e.key,t||""),searchable:!0,clearable:!0,size:"xs"})]},"filter-".concat(t)))})]}),(0,r.jsxs)(y.X.Tbody,{children:[a&&(0,r.jsx)(y.X.Tr,{children:(0,r.jsxs)(y.X.Td,{colSpan:m.length,children:[(0,r.jsx)(C.o,{p:"xl",children:(0,r.jsx)(_.E,{children:"Cargando usuarios..."})})," "]})}),!a&&0===t.length&&(0,r.jsx)(y.X.Tr,{children:(0,r.jsx)(y.X.Td,{colSpan:m.length,children:(0,r.jsx)(C.o,{p:"xl",children:(0,r.jsx)(_.E,{c:"dimmed",children:"No se encontraron usuarios."})})})}),!a&&F]})]})}),(0,r.jsxs)(n.Y,{justify:"space-between",align:"center",p:"md",className:O().paginationFooter,children:[(0,r.jsxs)(_.E,{size:"sm",children:["Mostrando"," ",t.length>0?l.pageIndex*l.pageSize+1:0," ","-"," ",Math.min((l.pageIndex+1)*l.pageSize,s)," ","de ",s," usuarios"]}),(0,r.jsx)(I.d,{total:D,value:l.pageIndex+1,onChange:e=>u({...l,pageIndex:e-1}),siblings:1,boundaries:1,withEdges:!0,size:"sm"}),(0,r.jsx)(U.l,{size:"xs",style:{width:120},data:["5","10","20","50"].map(e=>({label:"".concat(e," por p\xe1gina"),value:e})),value:l.pageSize.toString(),onChange:e=>u({pageIndex:0,pageSize:Number(e)})})]})]})}let L=new p.E({defaultOptions:{queries:{staleTime:2e4,refetchOnWindowFocus:!1}}});function W(){return(0,r.jsx)(x.Ht,{client:L,children:(0,r.jsx)(M,{})})}function M(){let e=(0,b.useRouter)(),t=(0,x.jE)(),[a,p]=(0,s.useState)([]),[y,f]=(0,s.useState)([{id:"name",desc:!1}]),[A,S]=(0,s.useState)({pageIndex:0,pageSize:10}),{data:k,isError:T,isFetching:_,isLoading:E,refetch:U}=(0,m.I)({queryKey:["pwa-users",a,A.pageIndex,A.pageSize,y],queryFn:()=>v.X.getUsers({pagination:A,sorting:y,columnFilters:a})}),C=(null==k?void 0:k.data)||[],I=(null==k?void 0:k.total)||0,{mutateAsync:z}=(0,j.n)({mutationFn:async e=>e.isActive?v.X.deactivateUser(e.id):v.X.activateUser(e.id),onSuccess:()=>{w.$e.show({title:"Usuario Desactivado",message:"El usuario ha sido desactivado correctamente.",color:"green",icon:(0,r.jsx)(d.A,{size:18})}),t.invalidateQueries({queryKey:["pwa-users"]})},onError:e=>{w.$e.show({title:"Error al Desactivar",message:e.message||"No se pudo desactivar el usuario.",color:"red",icon:(0,r.jsx)(u.A,{size:18})})}}),P=async e=>{let t=e.isActive?"desactivar":"activar";window.confirm("\xbfEst\xe1 seguro de que desea ".concat(t," a ").concat(e.name,"?"))&&(await z(e),w.$e.show({title:"Info",message:"Funci\xf3n de activar pendiente.",color:"blue"}))};return(0,r.jsxs)(i.a,{p:"lg",children:[(0,r.jsxs)(n.Y,{justify:"space-between",mb:"xl",children:[(0,r.jsx)(l.h,{order:2,children:"Gesti\xf3n de Usuarios (Clientes PWA)"}),(0,r.jsxs)(n.Y,{children:[(0,r.jsx)(o.$,{onClick:()=>alert("Ruta de creaci\xf3n pendiente: /admin/users-pwa/create"),leftSection:(0,r.jsx)(h.A,{size:18}),variant:"light",color:"blue",children:"Crear Usuario PWA"}),(0,r.jsx)(o.$,{onClick:()=>U(),leftSection:(0,r.jsx)(g.A,{size:18}),variant:"default",loading:_&&!E,disabled:_&&!E,children:"Refrescar"})]})]}),T&&!E&&(0,r.jsx)(c.F,{icon:(0,r.jsx)(u.A,{size:"1rem"}),title:"Error de Carga",color:"red",withCloseButton:!0,mb:"md",children:"No se pudieron cargar los datos de los usuarios. Intente refrescar."}),(0,r.jsx)(D,{users:C,isLoading:E||_&&0===C.length,totalRowCount:I,pagination:A,sorting:y,columnFilters:a,onPaginationChange:e=>{S(e)},onSortingChange:e=>{f(e),S(e=>({...e,pageIndex:0}))},onColumnFiltersChange:e=>{p(e),S(e=>({...e,pageIndex:0}))},onEditUser:t=>{e.push("/admin/users-pwa/edit/".concat(t.id))},handleToggleUserActivation:P})]})}},9018:(e,t,a)=>{"use strict";a.d(t,{n:()=>i});var r=a(5453),s=a(6786);let i=(0,r.v)()((0,s.Zr)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,theme:"light",setUser:(t,a)=>{console.log("AuthStore: Setting user and token",{user:t,token:a}),e({user:t,token:a,isAuthenticated:!!t&&!!a,isLoading:!1,error:null})},logout:()=>{console.log("AuthStore: Logging out"),e({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null})},setCountryOfOrigin:t=>{e(e=>({user:e.user?{...e.user,countryOfOrigin:t}:null}))},setLoading:t=>e({isLoading:t}),setError:t=>e({isLoading:!1,error:t}),hydrateAuth:(t,a)=>{t&&a?(console.log("AuthStore: Hydrating auth state",{initialUser:t,initialToken:a}),e({user:t,token:a,isAuthenticated:!0,isLoading:!1,error:null})):e({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null})},setTheme:t=>{console.log("AuthStore: Setting theme to",t),e({theme:t})},toggleTheme:()=>{let a,r=t().theme;console.log("AuthStore: Toggling theme to",a="light"===r?"dark":"dark"===r||window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"light":"dark"),e({theme:a})}}),{name:"pwa-auth-storage",storage:(0,s.KU)(()=>localStorage),partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated,theme:e.theme}),onRehydrateStorage:()=>e=>{console.log("AuthStore: State rehydrated from localStorage. Theme:",null==e?void 0:e.theme),e&&(e.isLoading=!1)}}))}},e=>{var t=t=>e(e.s=t);e.O(0,[951,545,438,660,877,700,219,142,749,811,258,11,441,684,358],()=>t(5794)),_N_E=e.O()}]);