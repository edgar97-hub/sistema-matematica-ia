(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{463:(e,t,r)=>{Promise.resolve().then(r.bind(r,7638))},2956:(e,t,r)=>{"use strict";r.d(t,{u:()=>s});var a=r(3464),o=r(9018);let s=a.A.create({baseURL:"http://161.132.41.184:3000/api"});s.interceptors.request.use(e=>{let t=o.n.getState().token;return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&!window.location.pathname.endsWith("/login")&&(console.warn("API client: 401 Unauthorized, logging out."),o.n.getState().logout()),Promise.reject(e)))},4230:(e,t,r)=>{"use strict";r.d(t,{p:()=>y});var a=r(5155);r(2115);var o=r(8750),s=r(8918),i=r(3131),n=r(3664),l=r(862),u=r(8104),d=r(6960),c=r(3347),g=r(6231),m=r(704),h={root:"m_6e45937b",loader:"m_e8eb006c",overlay:"m_df587f17"};let p={transitionProps:{transition:"fade",duration:0},overlayProps:{backgroundOpacity:.75},zIndex:(0,o.I)("overlay")},v=(0,s.V)((e,t)=>{let{zIndex:r}=t;return{root:{"--lo-z-index":null==r?void 0:r.toString()}}}),y=(0,d.P9)((e,t)=>{let r=(0,n.Y)("LoadingOverlay",p,e),{classNames:o,className:s,style:d,styles:y,unstyled:x,vars:A,transitionProps:b,loaderProps:f,overlayProps:j,visible:S,zIndex:E,...w}=r,k=(0,i.xd)(),I=(0,l.I)({name:"LoadingOverlay",classes:h,props:r,className:s,style:d,classNames:o,styles:y,unstyled:x,vars:A,varsResolver:v}),O={...p.overlayProps,...j};return(0,a.jsx)(m.e,{transition:"fade",...b,mounted:!!S,children:e=>(0,a.jsxs)(u.a,{...I("root",{style:e}),ref:t,...w,children:[(0,a.jsx)(c.a,{...I("loader"),unstyled:x,...f}),(0,a.jsx)(g.h,{...O,...I("overlay"),darkHidden:!0,unstyled:x,color:(null==j?void 0:j.color)||k.white}),(0,a.jsx)(g.h,{...O,...I("overlay"),lightHidden:!0,unstyled:x,color:(null==j?void 0:j.color)||k.colors.dark[5]})]})})});y.classes=h,y.displayName="@mantine/core/LoadingOverlay"},6231:(e,t,r)=>{"use strict";r.d(t,{h:()=>v});var a=r(5155),o=r(5903);r(2115);var s=r(8750),i=r(6204),n=r(8918),l=r(714),u=r(3664),d=r(862),c=r(8104),g=r(4511),m={root:"m_9814e45f"};let h={zIndex:(0,s.I)("modal")},p=(0,n.V)((e,t)=>{let{gradient:r,color:a,backgroundOpacity:s,blur:n,radius:u,zIndex:d}=t;return{root:{"--overlay-bg":r||(void 0!==a||void 0!==s)&&(0,l.B)(a||"#000",null!=s?s:.6)||void 0,"--overlay-filter":n?"blur(".concat((0,o.D)(n),")"):void 0,"--overlay-radius":void 0===u?void 0:(0,i.nJ)(u),"--overlay-z-index":null==d?void 0:d.toString()}}}),v=(0,g.v)((e,t)=>{let r=(0,u.Y)("Overlay",h,e),{classNames:o,className:s,style:i,styles:n,unstyled:l,vars:g,fixed:v,center:y,children:x,radius:A,zIndex:b,gradient:f,blur:j,color:S,backgroundOpacity:E,mod:w,...k}=r,I=(0,d.I)({name:"Overlay",props:r,classes:m,className:s,style:i,classNames:o,styles:n,unstyled:l,vars:g,varsResolver:p});return(0,a.jsx)(c.a,{ref:t,...I("root"),mod:[{center:y,fixed:v},w],...k,children:x})});v.classes=m,v.displayName="@mantine/core/Overlay"},6731:(e,t,r)=>{"use strict";r.d(t,{X:()=>o});var a=r(2956);let o={async getUsers(e){let t={};return t.page=e.pagination.pageIndex+1,t.limit=e.pagination.pageSize,e.sorting&&e.sorting.length>0&&(t.sortField=e.sorting[0].id,t.sortDirection=e.sorting[0].desc?"DESC":"ASC"),e.columnFilters&&e.columnFilters.length>0&&e.columnFilters.forEach(e=>{void 0!==e.value&&""!==e.value&&null!==e.value&&(t[e.id]=e.value)}),(await a.u.get("/users",{params:t})).data},async deactivateUser(e){await a.u.delete("/users/".concat(e))},async activateUser(e){await a.u.delete("/users/".concat(e))},async getUserById(e){if(console.log("PWAUSER_SERVICE: Attempting to fetch user with ID: ".concat(e)),!e)return console.error("PWAUSER_SERVICE: getUserById called with no ID."),Promise.reject(Error("User ID is required"));try{let t=await a.u.get("/users/".concat(e));return console.log("PWAUSER_SERVICE: Data received for ".concat(e,":"),t.data),t.data}catch(t){throw console.error("PWAUSER_SERVICE: Error fetching user ".concat(e,":"),t),t}},async updateUser(e,t){let{email:r,...o}=t;return(await a.u.patch("/users/".concat(e),o)).data}}},7638:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>z});var a=r(5155),o=r(2115),s=r(5695),i=r(8104),n=r(4230),l=r(8887),u=r(4634),d=r(112),c=r(3751),g=r(6707),m=r(9511),h=r(8977),p=r(5647),v=r(6715),y=r(2960),x=r(5041),A=r(6942),b=r(6731),f=r(8593),j=r(7683),S=r(9260),E=r(1659),w=r(9161),k=r(1153);let I=k.z.object({name:k.z.string().min(1,{message:"El nombre es requerido"}),email:k.z.string().email({message:"Correo inv\xe1lido"}),countryOfOrigin:k.z.string().nullable().optional(),credits:k.z.number().min(0,{message:"Cr\xe9ditos no pueden ser negativos"}),isActive:k.z.boolean()});function O(e){let{initialData:t,onSubmit:r,isSaving:s,onCancel:i}=e,n=(0,E.m)({initialValues:t||{name:"",email:"",countryOfOrigin:null,credits:0,isActive:!0},validate:(0,w.u)(I)});return(0,o.useEffect)(()=>{t&&n.setValues(t)},[t]),(0,a.jsxs)("form",{onSubmit:n.onSubmit(e=>r(e)),children:[(0,a.jsx)(f.k,{label:"Nombre Completo",placeholder:"Nombre del usuario",required:!0,...n.getInputProps("name"),mb:"md"}),(0,a.jsx)(f.k,{label:"Correo Electr\xf3nico",disabled:!0,...n.getInputProps("email"),mb:"md"}),(0,a.jsx)(f.k,{label:"Pa\xeds de Origen",placeholder:"Pa\xeds",...n.getInputProps("countryOfOrigin"),mb:"md"}),(0,a.jsx)(j.Q,{label:"Cr\xe9ditos",placeholder:"Saldo de cr\xe9ditos",required:!0,min:0,...n.getInputProps("credits"),mb:"md"}),(0,a.jsx)(S.S,{label:"Usuario Activo",...n.getInputProps("isActive",{type:"checkbox"}),mt:"md",mb:"xl"}),(0,a.jsxs)(d.Y,{justify:"flex-end",children:[(0,a.jsx)(g.$,{variant:"default",onClick:i,disabled:s,children:"Cancelar"}),(0,a.jsx)(g.$,{type:"submit",loading:s,disabled:!n.isDirty()&&!s,children:t?"Actualizar Usuario":"Guardar Usuario"})]})]})}function z(){let[e,t]=(0,o.useState)(null),r=(0,s.useRouter)(),f=(0,s.useParams)().id,j=(0,v.jE)(),{data:S,isLoading:E,isError:w,error:k,refetch:I}=(0,y.I)({queryKey:["pwa-users",f],queryFn:()=>b.X.getUserById(f),enabled:!!f,staleTime:3e5}),{mutateAsync:z}=(0,x.n)({mutationFn:e=>b.X.updateUser(f,e),onSuccess:e=>{A.$e.show({title:"Paquete Actualizado",message:'El paquete "'.concat(e.name,'" ha sido actualizado exitosamente.'),color:"green",icon:(0,a.jsx)(m.A,{size:18})}),j.invalidateQueries({queryKey:["pwa-users"]}),j.setQueryData(["pwa-users",f],e),r.push("/admin/users-pwa")},onError:e=>{A.$e.show({title:"Error al Actualizar",message:e.message||"No se pudo actualizar el paquete de cr\xe9dito.",color:"red",icon:(0,a.jsx)(h.A,{size:18})})}}),P=async e=>{await z(e)};return(console.log("user",S),(0,o.useEffect)(()=>{S&&t({name:S.name,email:S.email,countryOfOrigin:S.countryOfOrigin||"",credits:S.credits,isActive:S.isActive})},[S]),E)?(0,a.jsxs)(i.a,{p:"lg",children:[(0,a.jsx)(n.p,{visible:!0}),(0,a.jsx)(l.E,{children:"Cargando datos del usuario..."})]}):w||!S?(0,a.jsx)(i.a,{p:"lg",children:(0,a.jsxs)(u.F,{icon:(0,a.jsx)(h.A,{size:"1rem"}),title:"Error",color:"red",withCloseButton:!0,onClose:()=>r.push("/admin/users-pwa"),children:["No se pudieron cargar los datos del usuario o el usuario no existe. Error: ",null==k?void 0:k.message]})}):(0,a.jsxs)(i.a,{p:"lg",children:[(0,a.jsxs)(d.Y,{justify:"space-between",mb:"xl",children:[(0,a.jsxs)(c.h,{order:2,children:["Editar Usuario PWA: ",null==S?void 0:S.name]}),(0,a.jsx)(g.$,{component:"a",onClick:()=>r.push("/admin/users-pwa"),variant:"default",leftSection:(0,a.jsx)(p.A,{size:16}),children:"Volver a la Lista"})]}),e&&(0,a.jsx)(O,{initialData:e,onSubmit:P,isSaving:!1,onCancel:()=>r.push("/admin/users-pwa")})]})}},9018:(e,t,r)=>{"use strict";r.d(t,{n:()=>s});var a=r(5453),o=r(6786);let s=(0,a.v)()((0,o.Zr)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,theme:"light",setUser:(t,r)=>{console.log("AuthStore: Setting user and token",{user:t,token:r}),e({user:t,token:r,isAuthenticated:!!t&&!!r,isLoading:!1,error:null})},logout:()=>{console.log("AuthStore: Logging out"),e({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null})},setCountryOfOrigin:t=>{e(e=>({user:e.user?{...e.user,countryOfOrigin:t}:null}))},setLoading:t=>e({isLoading:t}),setError:t=>e({isLoading:!1,error:t}),hydrateAuth:(t,r)=>{t&&r?(console.log("AuthStore: Hydrating auth state",{initialUser:t,initialToken:r}),e({user:t,token:r,isAuthenticated:!0,isLoading:!1,error:null})):e({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null})},setTheme:t=>{console.log("AuthStore: Setting theme to",t),e({theme:t})},toggleTheme:()=>{let r,a=t().theme;console.log("AuthStore: Toggling theme to",r="light"===a?"dark":"dark"===a||window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"light":"dark"),e({theme:r})}}),{name:"pwa-auth-storage",storage:(0,o.KU)(()=>localStorage),partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated,theme:e.theme}),onRehydrateStorage:()=>e=>{console.log("AuthStore: State rehydrated from localStorage. Theme:",null==e?void 0:e.theme),e&&(e.isLoading=!1)}}))},9511:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var a=(0,r(6467).A)("outline","device-floppy","IconDeviceFloppy",[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[438,660,877,700,219,142,347,749,90,936,441,684,358],()=>t(463)),_N_E=e.O()}]);